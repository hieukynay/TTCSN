<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EnglishCenter • Trang chủ</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
<header class="site-header">
  <nav class="nav container">
    <a class="brand" href="#">EnglishCenter</a>
    <ul class="nav-list">
      <li><a href="#" id="loginBtn">Đăng nhập</a></li>
      <li><a href="#" id="registerBtn">Đăng ký</a></li>
    </ul>
  </nav>
</header>

<main class="container">
  <section class="hero">
    <h1>Trung tâm tiếng Anh • Học nhanh - Nhớ lâu</h1>
    <p>Đăng ký lớp, theo dõi lịch học, nộp học phí – tất cả trong một nơi.</p>
    <div class="cta">
      <a class="btn" href="#" id="loginHeroBtn">Đăng nhập</a>
      <a class="btn btn-outline" href="#" id="registerHeroBtn">Đăng ký</a>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container"><p>© 2025 EnglishCenter.</p></div>
</footer>

<!-- LOGIN MODAL -->
<div class="modal" id="loginModal">
  <div class="modal-content card narrow">
    <button class="modal-close" data-close="loginModal">×</button>
    <h2>Đăng nhập</h2>
    <form id="loginForm" class="form">
      <label><span>Tên đăng nhập</span><input type="text" name="username" required></label>
      <label><span>Mật khẩu</span><input type="password" name="password" required></label>
      <button class="btn" type="submit">Đăng nhập</button>
      <div id="loginMsg" class="msg"></div>
    </form>
  </div>
</div>

<!-- REGISTER MODAL -->
<div class="modal" id="registerModal">
  <div class="modal-content card narrow">
    <button class="modal-close" data-close="registerModal">×</button>
    <h2>Đăng ký tài khoản</h2>
    <form id="registerForm" class="form">
      <label><span>Họ và tên</span><input type="text" name="hoTen" required></label>
      <label><span>Email</span><input type="email" name="email" required></label>
      <label><span>Số điện thoại</span><input type="text" name="soDienThoai" required></label>
      <label><span>Tên đăng nhập</span><input type="text" name="tenDangNhap" required></label>
      <label><span>Mật khẩu</span><input type="password" name="matKhau" required></label>
      <label><span>Vai trò</span>
        <select name="vaiTro">
          <option value="HocVien" selected>Học viên</option>
          <option value="GiaoVien">Giáo viên</option>
          <option value="Admin">Admin</option>
        </select>
      </label>
      <button class="btn" type="submit">Đăng ký</button>
      <div id="regMsg" class="msg"></div>
    </form>
  </div>
</div>

<script src="assets/app.js"></script>
<script>
  // modal
  const modals = { login: document.getElementById('loginModal'), register: document.getElementById('registerModal') };
  const openModal  = (m) => m.classList.add('open');
  const closeModal = (m) => m.classList.remove('open');
  document.getElementById('loginBtn').onclick = () => openModal(modals.login);
  document.getElementById('registerBtn').onclick = () => openModal(modals.register);
  document.getElementById('loginHeroBtn').onclick = () => openModal(modals.login);
  document.getElementById('registerHeroBtn').onclick = () => openModal(modals.register);
  document.querySelectorAll('.modal-close').forEach(b => b.onclick = (e)=> closeModal(document.getElementById(e.target.dataset.close)));
  document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', e => { if (e.target===m) closeModal(m); }));

  // login
  document.getElementById('loginForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const f = e.currentTarget, msg = document.getElementById('loginMsg');
    msg.textContent = 'Đang đăng nhập...';
    try{
      const data = await apiLogin(f.username.value.trim(), f.password.value);
      msg.textContent = 'Đăng nhập thành công!';
      setTimeout(()=> redirectByRole(data.role), 700);
    }catch(err){
      msg.textContent = err.message || 'Không thể đăng nhập'; msg.classList.add('error');
    }
  });

  // register
  document.getElementById('registerForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const f = e.currentTarget, msg = document.getElementById('regMsg');
    msg.textContent = 'Đang đăng ký...';
    try{
      await apiRegister({
        tenDangNhap: f.tenDangNhap.value.trim(),
        matKhau: f.matKhau.value,
        hoTen: f.hoTen.value.trim(),
        email: f.email.value.trim(),
        soDienThoai: f.soDienThoai.value.trim(),
        vaiTro: f.vaiTro.value
      });
      msg.textContent = 'Đăng ký thành công! Vui lòng đăng nhập.';
      setTimeout(()=>{ closeModal(modals.register); openModal(modals.login); }, 800);
    }catch(err){
      msg.textContent = err.message || 'Không thể đăng ký'; msg.classList.add('error');
    }
  });

  // nếu đã đăng nhập có thể tự điều hướng (tuỳ chọn)
  // const auth = getAuth(); if (auth?.role) redirectByRole(auth.role);
</script>
</body>
</html>
